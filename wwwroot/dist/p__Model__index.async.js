"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[377],{57598:function(pe,V,e){e.r(V),e.d(V,{default:function(){return te}});var $=e(23430),R=e(88484),X=e(38496),D=e(90905),W=e(16536),o=e(71230),b=e(15746),d=e(59652),j=e(93940),h=e(32808),f=e(83134),S=e(71577),G=e(78116),Y=e(67294),T=e(68750),k=e(97857),L=e.n(k),q=e(15009),F=e.n(q),_=e(99289),E=e.n(_),ee=e(50888),N=e(8751),ne=e(85402),H=e(61980),K=e(34041),M=e(65633),n=e(85893),z=function(P){var B=P.models;return(0,n.jsxs)(j.Z,{labelCol:{span:6},style:{marginTop:10},onFinish:function(){var x=E()(F()().mark(function A(r){var s,u,l,a,c;return F()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(r.imgs){i.next=3;break}return W.ZP.warning("\u8BF7\u4E0A\u4F20\u7167\u7247\u540E\u518D\u64CD\u4F5C"),i.abrupt("return");case 3:return s=r.imgs.fileList.filter(function(t){return t.originFileObj}),u=ne.Z.info({title:"\u8BC6\u522B\u4E2D...",icon:(0,n.jsx)(ee.Z,{}),closable:!0,width:500,centered:!0,content:(0,n.jsx)(H.Z,{infinite:!1,draggable:!0,children:s.map(function(t){return(0,n.jsx)("div",{children:(0,n.jsx)("canvas",{id:t.name,style:{maxHeight:400,maxWidth:"100%"}})},t.uid)})})}),l=s.map(function(){var t=E()(F()().mark(function p(m){var y,U,w,g,C,se,ue;return F()().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return y=new Image,y.src=URL.createObjectURL(m.originFileObj),O.next=4,y.decode();case 4:U=cv.imread(y),cv.imshow(m.name,U),w=document.getElementById(m.name),g=w.getContext("2d"),C=new cv.RectVector;try{M.s.detectMultiScale(U,C,1.1,3,0),U.delete()}catch(re){console.log(re)}return se=new Array(C.size()).fill(0).map(function(){var re=E()(F()().mark(function ie(fe,le){var v,J,Q,ce,oe;return F()().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return v=C.get(le),g.strokeRect(v.x,v.y,v.width,v.height),J=document.createElement("canvas"),Q=J.getContext("2d"),J.width=v.width,J.height=v.height,Q==null||Q.drawImage(y,v.x,v.y,v.width,v.height,0,0,v.width,v.height),I.next=9,new Promise(function(me){J.toBlob(function(ae){var de=void 0;ae&&(de=new File([ae],"".concat(le,"_").concat(m.name),{type:ae.type})),me(de)})});case 9:return ce=I.sent,oe={x:v.x,y:v.y,faceFile:ce},I.abrupt("return",oe);case 12:case"end":return I.stop()}},ie)}));return function(ie,fe){return re.apply(this,arguments)}}()),O.next=13,Promise.all(se);case 13:return ue=O.sent,C.delete(),O.abrupt("return",{ctx:g,name:m.name,msg:ue});case 16:case"end":return O.stop()}},p)}));return function(p){return t.apply(this,arguments)}}()),i.next=8,Promise.all(l);case 8:a=i.sent,c=a.flatMap(function(t){return t.msg}).map(function(t){return t.faceFile}).filter(Boolean),T.Z.Face.postFacePredict({model:r.model},{},c).then(function(t){var p;(p=t.data)===null||p===void 0||p.forEach(function(m){var y=m.name.indexOf("_");if(y>-1){var U=m.name.substring(y+1),w=Number(m.name.substring(0,y)),g=a.find(function(C){return C.name==U});g&&(g.ctx.font='20px "\u5FAE\u8F6F\u96C5\u9ED1"',g.ctx.fillStyle="red",g.ctx.textBaseline="top",g.ctx.fillText("id:".concat(m.label," c:").concat(m.confidence.toFixed(0)),g.msg[w].x,g.msg[w].y),g.ctx.fillText(m.msg,g.msg[w].x,g.msg[w].y+20))}}),u.update(function(m){return L()(L()({},m),{},{title:"\u8BC6\u522B\u5B8C\u6210",icon:(0,n.jsx)(N.Z,{})})})});case 11:case"end":return i.stop()}},A)}));return function(A){return x.apply(this,arguments)}}(),children:[(0,n.jsx)(j.Z.Item,{label:"\u9009\u62E9\u6A21\u578B",name:"model",children:(0,n.jsx)(K.Z,{placeholder:"\u9ED8\u8BA4\u4F7F\u7528\u6700\u65B0\u7684\u6A21\u578B",children:B==null?void 0:B.map(function(x){return(0,n.jsx)(K.Z.Option,{value:x.name,children:x.name},x.uid)})})}),(0,n.jsx)(j.Z.Item,{label:"\u9009\u62E9\u56FE\u7247",name:"imgs",valuePropName:"img",children:(0,n.jsx)(G.Z,{listType:"picture",multiple:!0,beforeUpload:function(){return!1},className:"upload-list-inline",children:(0,n.jsx)(S.Z,{icon:(0,n.jsx)(R.Z,{}),children:"Upload"})})}),(0,n.jsx)(j.Z.Item,{wrapperCol:{offset:8,span:16},children:(0,n.jsx)(S.Z,{type:"primary",htmlType:"submit",children:"\u8BC6\u522B"})})]})},te=function(){var P=(0,D.useRequest)(T.Z.Face.postFaceTrain,{manual:!0,onSuccess:function(t){W.ZP.success(t.msg),s()}}),B=P.loading,x=P.run,A=(0,D.useRequest)(T.Z.Face.getFaceGet),r=A.data,s=A.run,u=(0,D.useRequest)(T.Z.Face.postFaceAdd,{manual:!0,onSuccess:function(){s()}}),l=u.run,a=(0,D.useRequest)(T.Z.Face.deleteFaceDelete,{manual:!0,onSuccess:function(){s()}}),c=a.run,Z=(0,Y.useMemo)(function(){if(r!=null&&r.list)return r.list.map(function(i,t){return{uid:t.toString(),src:i,name:i.split("/").at(-1),status:"done"}})},[r]);return(0,n.jsxs)(X._z,{header:{title:"\u6A21\u578B\u7BA1\u7406"},children:[(0,n.jsxs)(o.Z,{gutter:[16,16],children:[(0,n.jsx)(b.Z,{xs:24,md:12,children:(0,n.jsx)(d.Z,{title:"\u8BAD\u7EC3",children:(0,n.jsxs)(j.Z,{labelCol:{span:6},style:{marginTop:10},initialValues:{label:["Name"],type:"LBPH"},onFinish:function(t){x({type:t.type},t.label||[])},children:[(0,n.jsx)(j.Z.Item,{label:"\u9644\u52A0\u5185\u5BB9",name:"label",valuePropName:"checked",children:(0,n.jsxs)(h.Z.Group,{children:[(0,n.jsx)(h.Z,{value:"Name",children:"\u59D3\u540D"}),(0,n.jsx)(h.Z,{value:"Phone",children:"\u624B\u673A\u53F7"})]})}),(0,n.jsx)(j.Z.Item,{label:"\u9009\u62E9\u7B97\u6CD5",name:"type",children:(0,n.jsxs)(f.ZP.Group,{children:[(0,n.jsx)(f.ZP,{value:"LBPH",children:"LBPH"}),(0,n.jsx)(f.ZP,{value:"Eigen",children:"Eigen"}),(0,n.jsx)(f.ZP,{value:"Fisher",disabled:!0,children:"Fisher"})]})}),(0,n.jsx)(j.Z.Item,{wrapperCol:{offset:8,span:16},children:(0,n.jsx)(S.Z,{loading:B,type:"primary",htmlType:"submit",children:"\u542F\u52A8\u8BAD\u7EC3"})})]})})}),(0,n.jsx)(b.Z,{xs:24,md:12,children:(0,n.jsx)(d.Z,{title:"\u6D4B\u8BD5",children:(0,n.jsx)(z,{models:Z})})}),(0,n.jsx)(b.Z,{xs:24,md:12,children:(0,n.jsx)(d.Z,{title:"\u7BA1\u7406",children:(0,n.jsx)(G.Z,{fileList:Z,onPreview:void 0,showUploadList:{showDownloadIcon:!0,downloadIcon:function(t){return(0,n.jsx)($.Z,{onClick:function(){fetch(t.src).then(function(m){return m.blob().then(function(y){var U=document.createElement("a"),w=window.URL.createObjectURL(y);U.href=w,U.download=t.src.split("/").at(-1),U.click(),window.URL.revokeObjectURL(w)})})}})}},onRemove:function(t){c({fileName:t.name})},beforeUpload:function(t){return l({},t),!1},children:(0,n.jsx)(S.Z,{icon:(0,n.jsx)(R.Z,{}),children:"Upload"})})})})]}),(0,n.jsx)("iframe",{name:"downmodel",style:{display:"none"}})]})}},68750:function(pe,V,e){e.d(V,{Z:function(){return A}});var $={};e.r($),e.d($,{deleteFaceDelete:function(){return _},getFaceGet:function(){return Y},postFaceAdd:function(){return q},postFacePredict:function(){return k},postFaceTrain:function(){return S}});var R={};e.r(R),e.d(R,{deleteUserDelFace:function(){return B},deleteUserDelete:function(){return K},getUserGet:function(){return n},postUserAdd:function(){return ee},postUserAddImg:function(){return ne},putUserPut:function(){return te}});var X=e(52677),D=e.n(X),W=e(15009),o=e.n(W),b=e(97857),d=e.n(b),j=e(99289),h=e.n(j),f=e(90905);function S(r,s,u){return G.apply(this,arguments)}function G(){return G=h()(o()().mark(function r(s,u,l){return o()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",(0,f.request)("/api/Face/Train",d()({method:"POST",headers:{"Content-Type":"application/json"},params:d()({type:"LBPH"},s),data:u},l||{})));case 1:case"end":return c.stop()}},r)})),G.apply(this,arguments)}function Y(r){return T.apply(this,arguments)}function T(){return T=h()(o()().mark(function r(s){return o()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,f.request)("/api/Face/Get",d()({method:"GET"},s||{})));case 1:case"end":return l.stop()}},r)})),T.apply(this,arguments)}function k(r,s,u,l){return L.apply(this,arguments)}function L(){return L=h()(o()().mark(function r(s,u,l,a){var c;return o()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return c=new FormData,l&&l.forEach(function(t){return c.append("image",t||"")}),Object.keys(u).forEach(function(t){var p=u[t];p!=null&&c.append(t,D()(p)==="object"&&!(p instanceof File)?JSON.stringify(p):p)}),i.abrupt("return",(0,f.request)("/api/Face/Predict",d()({method:"POST",params:d()({},s),data:c,requestType:"form"},a||{})));case 4:case"end":return i.stop()}},r)})),L.apply(this,arguments)}function q(r,s,u){return F.apply(this,arguments)}function F(){return F=h()(o()().mark(function r(s,u,l){var a;return o()().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:return a=new FormData,u&&a.append("file",u),Object.keys(s).forEach(function(i){var t=s[i];t!=null&&a.append(i,D()(t)==="object"&&!(t instanceof File)?JSON.stringify(t):t)}),Z.abrupt("return",(0,f.request)("/api/Face/Add",d()({method:"POST",data:a,requestType:"form"},l||{})));case 4:case"end":return Z.stop()}},r)})),F.apply(this,arguments)}function _(r,s){return E.apply(this,arguments)}function E(){return E=h()(o()().mark(function r(s,u){return o()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,f.request)("/api/Face/Delete",d()({method:"DELETE",params:d()({},s)},u||{})));case 1:case"end":return a.stop()}},r)})),E.apply(this,arguments)}function ee(r,s){return N.apply(this,arguments)}function N(){return N=h()(o()().mark(function r(s,u){return o()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,f.request)("/api/User/Add",d()({method:"POST",params:d()({},s)},u||{})));case 1:case"end":return a.stop()}},r)})),N.apply(this,arguments)}function ne(r,s,u,l){return H.apply(this,arguments)}function H(){return H=h()(o()().mark(function r(s,u,l,a){var c;return o()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return c=new FormData,l&&l.forEach(function(t){return c.append("image",t||"")}),Object.keys(u).forEach(function(t){var p=u[t];p!=null&&c.append(t,D()(p)==="object"&&!(p instanceof File)?JSON.stringify(p):p)}),i.abrupt("return",(0,f.request)("/api/User/AddImg",d()({method:"POST",params:d()({},s),data:c,requestType:"form"},a||{})));case 4:case"end":return i.stop()}},r)})),H.apply(this,arguments)}function K(r,s){return M.apply(this,arguments)}function M(){return M=h()(o()().mark(function r(s,u){return o()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,f.request)("/api/User/Delete",d()({method:"DELETE",params:d()({},s)},u||{})));case 1:case"end":return a.stop()}},r)})),M.apply(this,arguments)}function n(r,s){return z.apply(this,arguments)}function z(){return z=h()(o()().mark(function r(s,u){return o()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,f.request)("/api/User/Get",d()({method:"GET",params:d()({current:"1",pageSize:"20"},s)},u||{})));case 1:case"end":return a.stop()}},r)})),z.apply(this,arguments)}function te(r,s){return P.apply(this,arguments)}function P(){return P=h()(o()().mark(function r(s,u){return o()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,f.request)("/api/User/Put",d()({method:"PUT",params:d()({},s)},u||{})));case 1:case"end":return a.stop()}},r)})),P.apply(this,arguments)}function B(r,s,u){return x.apply(this,arguments)}function x(){return x=h()(o()().mark(function r(s,u,l){return o()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",(0,f.request)("/api/User/DelFace",d()({method:"DELETE",headers:{"Content-Type":"application/json"},params:d()({},s),data:u},l||{})));case 1:case"end":return c.stop()}},r)})),x.apply(this,arguments)}var A={Face:$,User:R}}}]);
