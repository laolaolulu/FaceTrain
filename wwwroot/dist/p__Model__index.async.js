"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[377],{57598:function(he,V,e){e.r(V),e.d(V,{default:function(){return re}});var I=e(23430),B=e(88484),Y=e(38496),F=e(90905),W=e(16536),d=e(71230),A=e(15746),p=e(59652),y=e(93940),h=e(32808),f=e(83134),C=e(71577),O=e(78116),k=e(67294),Z=e(68750),q=e(15009),j=e.n(q),_=e(99289),T=e.n(_),ee=e(97857),R=e.n(ee),ne=e(8751),b=e(50888),te=e(85402),$=e(61980),K=e(34041),N=e(65633),n=e(85893),H=function(U){var D=U.models,w=(0,F.useRequest)(Z.Z.Face.postFacePredict,{manual:!0,onSuccess:function(u,l){var r=l[3];u==null||u.forEach(function(i){var m=i.name.indexOf("_");if(m>-1){var c=i.name.substring(m+1),s=Number(i.name.substring(0,m)),o=r.facemsg.find(function(x){return x.name==c});o&&(o.ctx.font='20px "\u5FAE\u8F6F\u96C5\u9ED1"',o.ctx.fillStyle="red",o.ctx.textBaseline="top",o.ctx.fillText("id:".concat(i.label," c:").concat(i.confidence.toFixed(0)),o.msg[s].x,o.msg[s].y),o.ctx.fillText(i.msg,o.msg[s].x,o.msg[s].y+20))}}),r.modal.update(function(i){return R()(R()({},i),{},{title:"\u8BC6\u522B\u5B8C\u6210",icon:(0,n.jsx)(ne.Z,{})})})}}),S=w.loading,a=w.run;return(0,n.jsxs)(y.Z,{labelCol:{span:6},style:{marginTop:10},onFinish:function(){var t=T()(j()().mark(function u(l){var r,i,m,c,s;return j()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(l.imgs){x.next=3;break}return W.ZP.warning("\u8BF7\u4E0A\u4F20\u7167\u7247\u540E\u518D\u64CD\u4F5C"),x.abrupt("return");case 3:return r=l.imgs.fileList.filter(function(g){return g.originFileObj}),i=te.Z.info({title:"\u8BC6\u522B\u4E2D...",icon:(0,n.jsx)(b.Z,{}),closable:!0,width:500,centered:!0,content:(0,n.jsx)($.Z,{infinite:!1,draggable:!0,children:r.map(function(g){return(0,n.jsx)("div",{children:(0,n.jsx)("canvas",{id:g.name,style:{maxHeight:400,maxWidth:"100%"}})},g.uid)})})}),m=r.map(function(){var g=T()(j()().mark(function G(P){var M,Q,ie,ae,z,le,ce;return j()().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return M=new Image,M.src=URL.createObjectURL(P.originFileObj),E.next=4,M.decode();case 4:Q=cv.imread(M),cv.imshow(P.name,Q),ie=document.getElementById(P.name),ae=ie.getContext("2d"),z=new cv.RectVector;try{N.s.detectMultiScale(Q,z,1.1,3,0),Q.delete()}catch(se){console.log(se)}return le=new Array(z.size()).fill(0).map(function(){var se=T()(j()().mark(function oe(ve,de){var v,J,X,pe,fe;return j()().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return v=z.get(de),ae.strokeRect(v.x,v.y,v.width,v.height),J=document.createElement("canvas"),X=J.getContext("2d"),J.width=v.width,J.height=v.height,X==null||X.drawImage(M,v.x,v.y,v.width,v.height,0,0,v.width,v.height),L.next=9,new Promise(function(ge){J.toBlob(function(ue){var me=void 0;ue&&(me=new File([ue],"".concat(de,"_").concat(P.name),{type:ue.type})),ge(me)})});case 9:return pe=L.sent,fe={x:v.x,y:v.y,faceFile:pe},L.abrupt("return",fe);case 12:case"end":return L.stop()}},oe)}));return function(oe,ve){return se.apply(this,arguments)}}()),E.next=13,Promise.all(le);case 13:return ce=E.sent,z.delete(),E.abrupt("return",{ctx:ae,name:P.name,msg:ce});case 16:case"end":return E.stop()}},G)}));return function(G){return g.apply(this,arguments)}}()),x.next=8,Promise.all(m);case 8:c=x.sent,s=c.flatMap(function(g){return g.msg}).map(function(g){return g.faceFile}).filter(Boolean),a({model:l.model},{},s,{modal:i,facemsg:c});case 11:case"end":return x.stop()}},u)}));return function(u){return t.apply(this,arguments)}}(),children:[(0,n.jsx)(y.Z.Item,{label:"\u9009\u62E9\u6A21\u578B",name:"model",children:(0,n.jsx)(K.Z,{placeholder:"\u9ED8\u8BA4\u4F7F\u7528\u6700\u65B0\u7684\u6A21\u578B",children:D==null?void 0:D.map(function(t){return(0,n.jsx)(K.Z.Option,{value:t.name,children:t.name},t.uid)})})}),(0,n.jsx)(y.Z.Item,{label:"\u9009\u62E9\u56FE\u7247",name:"imgs",valuePropName:"img",children:(0,n.jsx)(O.Z,{listType:"picture",multiple:!0,beforeUpload:function(){return!1},className:"upload-list-inline",children:(0,n.jsx)(C.Z,{icon:(0,n.jsx)(B.Z,{}),children:"Upload"})})}),(0,n.jsx)(y.Z.Item,{wrapperCol:{offset:8,span:16},children:(0,n.jsx)(C.Z,{loading:S,type:"primary",htmlType:"submit",children:"\u8BC6\u522B"})})]})},re=function(){var U=(0,F.useRequest)(Z.Z.Face.postFaceTrain,{manual:!0,onSuccess:function(s){W.ZP.success(s.msg),t()}}),D=U.loading,w=U.run,S=(0,F.useRequest)(Z.Z.Face.getFaceGet),a=S.data,t=S.run,u=(0,F.useRequest)(Z.Z.Face.postFaceAdd,{manual:!0,onSuccess:function(){t()}}),l=u.run,r=(0,F.useRequest)(Z.Z.Face.deleteFaceDelete,{manual:!0,onSuccess:function(){t()}}),i=r.run,m=(0,k.useMemo)(function(){if(a!=null&&a.list)return a.list.map(function(c,s){return{uid:s.toString(),src:c,name:c.split("/").at(-1),status:"done"}})},[a]);return(0,n.jsxs)(Y._z,{header:{title:"\u6A21\u578B\u7BA1\u7406"},children:[(0,n.jsxs)(d.Z,{gutter:[16,16],children:[(0,n.jsx)(A.Z,{xs:24,md:12,xxl:16,children:(0,n.jsxs)(d.Z,{gutter:[16,16],children:[(0,n.jsx)(A.Z,{xs:24,md:24,xxl:12,children:(0,n.jsx)(p.Z,{title:"\u8BAD\u7EC3",children:(0,n.jsxs)(y.Z,{labelCol:{span:6},style:{marginTop:10},initialValues:{label:["Name"],type:"LBPH"},onFinish:function(s){w({type:s.type},s.label||[])},children:[(0,n.jsx)(y.Z.Item,{label:"\u9644\u52A0\u5185\u5BB9",name:"label",valuePropName:"checked",children:(0,n.jsxs)(h.Z.Group,{children:[(0,n.jsx)(h.Z,{value:"Name",children:"\u59D3\u540D"}),(0,n.jsx)(h.Z,{value:"Phone",children:"\u624B\u673A\u53F7"})]})}),(0,n.jsx)(y.Z.Item,{label:"\u9009\u62E9\u7B97\u6CD5",name:"type",children:(0,n.jsxs)(f.ZP.Group,{children:[(0,n.jsx)(f.ZP,{value:"LBPH",children:"LBPH"}),(0,n.jsx)(f.ZP,{value:"Eigen",children:"Eigen"}),(0,n.jsx)(f.ZP,{value:"Fisher",disabled:!0,children:"Fisher"})]})}),(0,n.jsx)(y.Z.Item,{wrapperCol:{offset:8,span:16},children:(0,n.jsx)(C.Z,{loading:D,type:"primary",htmlType:"submit",children:"\u542F\u52A8\u8BAD\u7EC3"})})]})})}),(0,n.jsx)(A.Z,{xs:24,md:24,xxl:12,children:(0,n.jsx)(p.Z,{title:"\u7BA1\u7406",children:(0,n.jsx)(O.Z,{fileList:m,onPreview:void 0,showUploadList:{showDownloadIcon:!0,downloadIcon:function(s){return(0,n.jsx)(I.Z,{onClick:function(){fetch(s.src).then(function(x){return x.blob().then(function(g){var G=document.createElement("a"),P=window.URL.createObjectURL(g);G.href=P,G.download=s.src.split("/").at(-1),G.click(),window.URL.revokeObjectURL(P)})})}})}},onRemove:function(s){i({fileName:s.name})},beforeUpload:function(s){return l({},s),!1},children:(0,n.jsx)(C.Z,{icon:(0,n.jsx)(B.Z,{}),children:"Upload"})})})})]})}),(0,n.jsx)(A.Z,{xs:24,md:12,xxl:8,children:(0,n.jsx)(p.Z,{title:"\u6D4B\u8BD5",children:(0,n.jsx)(H,{models:m})})})]}),(0,n.jsx)("iframe",{name:"downmodel",style:{display:"none"}})]})}},68750:function(he,V,e){e.d(V,{Z:function(){return S}});var I={};e.r(I),e.d(I,{deleteFaceDelete:function(){return ee},getFaceGet:function(){return k},postFaceAdd:function(){return _},postFacePredict:function(){return q},postFaceTrain:function(){return C}});var B={};e.r(B),e.d(B,{deleteUserDelFace:function(){return D},deleteUserDelete:function(){return K},getUserGet:function(){return n},postUserAdd:function(){return ne},postUserAddImg:function(){return te},putUserPut:function(){return re}});var Y=e(52677),F=e.n(Y),W=e(15009),d=e.n(W),A=e(97857),p=e.n(A),y=e(99289),h=e.n(y),f=e(90905);function C(a,t,u){return O.apply(this,arguments)}function O(){return O=h()(d()().mark(function a(t,u,l){return d()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",(0,f.request)("/api/Face/Train",p()({method:"POST",headers:{"Content-Type":"application/json"},params:p()({type:"LBPH"},t),data:u},l||{})));case 1:case"end":return i.stop()}},a)})),O.apply(this,arguments)}function k(a){return Z.apply(this,arguments)}function Z(){return Z=h()(d()().mark(function a(t){return d()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,f.request)("/api/Face/Get",p()({method:"GET"},t||{})));case 1:case"end":return l.stop()}},a)})),Z.apply(this,arguments)}function q(a,t,u,l){return j.apply(this,arguments)}function j(){return j=h()(d()().mark(function a(t,u,l,r){var i;return d()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return i=new FormData,l&&l.forEach(function(s){return i.append("image",s||"")}),Object.keys(u).forEach(function(s){var o=u[s];o!=null&&i.append(s,F()(o)==="object"&&!(o instanceof File)?JSON.stringify(o):o)}),c.abrupt("return",(0,f.request)("/api/Face/Predict",p()({method:"POST",params:p()({},t),data:i,requestType:"form"},r||{})));case 4:case"end":return c.stop()}},a)})),j.apply(this,arguments)}function _(a,t,u){return T.apply(this,arguments)}function T(){return T=h()(d()().mark(function a(t,u,l){var r;return d()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return r=new FormData,u&&r.append("file",u),Object.keys(t).forEach(function(c){var s=t[c];s!=null&&r.append(c,F()(s)==="object"&&!(s instanceof File)?JSON.stringify(s):s)}),m.abrupt("return",(0,f.request)("/api/Face/Add",p()({method:"POST",data:r,requestType:"form"},l||{})));case 4:case"end":return m.stop()}},a)})),T.apply(this,arguments)}function ee(a,t){return R.apply(this,arguments)}function R(){return R=h()(d()().mark(function a(t,u){return d()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,f.request)("/api/Face/Delete",p()({method:"DELETE",params:p()({},t)},u||{})));case 1:case"end":return r.stop()}},a)})),R.apply(this,arguments)}function ne(a,t){return b.apply(this,arguments)}function b(){return b=h()(d()().mark(function a(t,u){return d()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,f.request)("/api/User/Add",p()({method:"POST",params:p()({},t)},u||{})));case 1:case"end":return r.stop()}},a)})),b.apply(this,arguments)}function te(a,t,u,l){return $.apply(this,arguments)}function $(){return $=h()(d()().mark(function a(t,u,l,r){var i;return d()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return i=new FormData,l&&l.forEach(function(s){return i.append("image",s||"")}),Object.keys(u).forEach(function(s){var o=u[s];o!=null&&i.append(s,F()(o)==="object"&&!(o instanceof File)?JSON.stringify(o):o)}),c.abrupt("return",(0,f.request)("/api/User/AddImg",p()({method:"POST",params:p()({},t),data:i,requestType:"form"},r||{})));case 4:case"end":return c.stop()}},a)})),$.apply(this,arguments)}function K(a,t){return N.apply(this,arguments)}function N(){return N=h()(d()().mark(function a(t,u){return d()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,f.request)("/api/User/Delete",p()({method:"DELETE",params:p()({},t)},u||{})));case 1:case"end":return r.stop()}},a)})),N.apply(this,arguments)}function n(a,t){return H.apply(this,arguments)}function H(){return H=h()(d()().mark(function a(t,u){return d()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,f.request)("/api/User/Get",p()({method:"GET",params:p()({current:"1",pageSize:"20"},t)},u||{})));case 1:case"end":return r.stop()}},a)})),H.apply(this,arguments)}function re(a,t){return U.apply(this,arguments)}function U(){return U=h()(d()().mark(function a(t,u){return d()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,f.request)("/api/User/Put",p()({method:"PUT",params:p()({},t)},u||{})));case 1:case"end":return r.stop()}},a)})),U.apply(this,arguments)}function D(a,t,u){return w.apply(this,arguments)}function w(){return w=h()(d()().mark(function a(t,u,l){return d()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",(0,f.request)("/api/User/DelFace",p()({method:"DELETE",headers:{"Content-Type":"application/json"},params:p()({},t),data:u},l||{})));case 1:case"end":return i.stop()}},a)})),w.apply(this,arguments)}var S={Face:I,User:B}}}]);
